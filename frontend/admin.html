<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MLCP System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">üÖøÔ∏è MLCP System</div>
            <ul class="nav-menu">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="parking.html">Parking</a></li>
                <li><a href="reservation.html">Reservations</a></li>
                <li><a href="admin.html" class="active">Admin</a></li>
            </ul>
        </nav>

        <div class="main-content">
            <h1>Admin Dashboard</h1>

            <div class="card">
                <h2>üîß Maintenance Alerts</h2>
                <div id="maintenanceAlerts">
                    <p>Loading maintenance alerts...</p>
                </div>
            </div>

            <div class="card">
                <h2>üìä Pricing Rules</h2>
                <table id="pricingTable">
                    <thead>
                        <tr>
                            <th>Vehicle Type</th>
                            <th>Base Price</th>
                            <th>Hourly Rate</th>
                            <th>Daily Rate</th>
                            <th>EV Charging</th>
                            <th>VIP Discount</th>
                        </tr>
                    </thead>
                    <tbody id="pricingBody">
                        <tr>
                            <td colspan="6" style="text-align: center;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>üöß Create Maintenance Alert</h2>
                <form id="maintenanceForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Slot Number</label>
                            <input type="text" id="alertSlotNumber" placeholder="G-CAR-001" required>
                        </div>
                        <div class="form-group">
                            <label>Alert Type</label>
                            <select id="alertType" required>
                                <option value="CLEANING">Cleaning</option>
                                <option value="REPAIR">Repair</option>
                                <option value="INSPECTION">Inspection</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Severity</label>
                            <select id="alertSeverity" required>
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                                <option value="CRITICAL">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" id="alertDescription" placeholder="Details..." required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-danger" style="margin-top: 10px;">Create Alert</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';

        document.addEventListener('DOMContentLoaded', function() {
            loadMaintenanceAlerts();
            loadPricingRules();
        });

        async function loadMaintenanceAlerts() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/maintenance`);
                const alerts = await response.json();

                const container = document.getElementById('maintenanceAlerts');
                if (alerts.length === 0) {
                    container.innerHTML = '<p style="color: #666;">No active maintenance alerts</p>';
                    return;
                }

                container.innerHTML = alerts.map(alert => `
                    <div style="background: ${getSeverityColor(alert.severity)}; padding: 15px; margin-bottom: 10px; border-radius: 5px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>${alert.slotNumber}</strong> - ${alert.alertType}
                                <p style="margin: 5px 0; font-size: 14px;">${alert.description}</p>
                                <small>${new Date(alert.createdAt).toLocaleString()}</small>
                            </div>
                            <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 3px; font-size: 12px;">
                                ${alert.severity}
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        async function loadPricingRules() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/pricing`);
                const rules = await response.json();

                const tbody = document.getElementById('pricingBody');
                tbody.innerHTML = rules.map(rule => `
                    <tr>
                        <td>${rule.vehicleType}</td>
                        <td>$${rule.basePrice.toFixed(2)}</td>
                        <td>$${rule.hourlyRate.toFixed(2)}</td>
                        <td>$${rule.dailyRate.toFixed(2)}</td>
                        <td>$${rule.evChargingRate.toFixed(2)}/hr</td>
                        <td>${rule.vipDiscountPercent}%</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading pricing rules:', error);
            }
        }

        function getSeverityColor(severity) {
            const colors = {
                'LOW': '#17a2b8',
                'MEDIUM': '#ffc107',
                'HIGH': '#fd7e14',
                'CRITICAL': '#dc3545'
            };
            return colors[severity] || '#6c757d';
        }

        document.getElementById('maintenanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            // Note: This would need to fetch slot ID first, simplified for demo
            alert('Maintenance alert creation - would need slot lookup first');
        });
    </script>
</body>
</html>
